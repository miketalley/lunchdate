<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<h1>Lunch Dates List</h1>

<!-- Dont show the map unless there are dates to be displayed -->
<% if @unconfirmed_other_users_lunch_dates.any? %>
<p>
<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>
</p>
<% end %>

<!-- Output each date with info and total count at bottom -->
<% count = 0 %>
<% @unconfirmed_other_users_lunch_dates.each do |ld| %>
  <p>
  <% count += 1 %>
  <%= image_tag(ld.creator.image_url, size: "80x80") %><br />
  Creator: <%= ld.creator.username %><br />
  Location: <%= ld.location_name %><br />
  Date/Time: <%= ld.date_time.strftime("%m/%d/%y - %I:%M%p") %><br />
  Matches Status: <ul>
    <% ld.matches.each do |match| %>
      <li><%= match.status %></li>
    <% end %>
  </ul>
  <%= link_to 'View/Accept Date Proposal', lunch_date_path(ld) %>
  </p>
<% end %>
<%= count %> Lunch Date(s) Found

<!-- Script for Gmap -->
<script type="text/javascript" charset="utf-8">
handler = Gmaps.build('Google');
handler.buildMap({
  provider: {
    disableDefaultUI: true
  },
  internal: {
    id: 'map'
  }},
  function(){
  markers = handler.addMarkers(<%= raw @hash.to_json %>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>
